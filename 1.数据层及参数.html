<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (en-US, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="319"/>

<div>
<span><div>要运行Caffe，需要先创建一个模型(model)，如比较常用的Lenet、Alex等，而一个模型由多个层(layer)构成，每一层又由许多参数组成。所有的参数都定义在caffe.proto这个文件中。要熟练使用Caffe，最重要的就是学会配置文件(prototxt)的编写。</div><div><br/></div><div>层有很多种类型，比如Data、Convolution、Pooling等，层之间的数据流动是以Blobs的方式进行。</div><div><br/></div><div>今天我们就先介绍一下数据层。</div><div><br/></div><div>数据层是每个模型的最底层，是模型的入口，不仅是提供数据的输入，也提供数据从Blobs转换成别的格式进行保存输出。通常数据的预处理(如减去均值、放大缩小、裁剪和镜像等)，也在这一层设置参数实现。</div><div><br/></div><div>数据来源可以来自高效的数据库(如LevelDB和LMDB)，也可以直接来自于内存。如果不是很注重效率的话，数据也可来自磁盘的hdf5文件和图片格式文件。</div><div><br/></div><div>所有的数据层都具有的公用参数，先看示例：</div><div><br/></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     name: &quot;cifar&quot;</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     type: &quot;Data&quot;</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     top: &quot;data&quot;</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     top: &quot;label&quot;</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     include {</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">          phase: TRAIN<br/></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     transform_param {</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">          mean_file: &quot;examples/cifar10/mean.binaryproto&quot;<br/></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     data_param {</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">          source: &quot;examples/cifar10/cifar10_train_lmdb&quot;</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">          batch_size: 100</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">          backend: LMDB<br/></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">}</span></div><div><br/></div><div><b>name</b>: 表示该层的名称，可随意取。</div><div><br/></div><div><b>type</b>: 层类型。如果是Data，表示数据来源于LevelDB或LMDB。根据数据的来源不同，数据层的类型也不同。一般在练习的时候，我们都是采用LevelDB或LMDB数据，因此层类型设置为Data。</div><div><br/></div><div><b>top</b>或<b>bottom</b>: 每一层用bottom来输入数据，用top来输出数据。如果只有top没有bottom，则此层只有输出，没有输入。反之亦然。如果有多个top或多个bottom，表示有多个blobs数据的输入或输出。</div><div><br/></div><div><b>data</b>与<b>label</b>: 在数据层，至少有一个命名为data的top。如果有第二个top，一般命名为label。这种(data, label)配对是分类模型所必需的。</div><div><br/></div><div><b>include</b>: 一般训练的时候和测试的时候，模型的层是不一样的。该层(layer)是属于训练阶段的层，还是属于测试阶段的层，需要include来指定。如果没有include参数，则表示该层既在训练模型中，又在测试模型中。</div><div><br/></div><div><b>transform_param</b>: 数据的预处理，可以将数据变换到定义的范围内。如设置scale为0.00390625，实际上就是1/255，即将输入数据由0~255归一化到0~1之间。</div><div><br/></div><div>其他的数据预处理也在这个地方设置：</div><div><br/></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">transform_param {</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     scale: 0.00390625</span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     mean_file: &quot;examples/cifar10/mean.binaryproto&quot; <span style="color: rgb(77, 206, 29);"># 用一个配置文件来进行均值操作</span></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     mirror: 1 <span style="color: rgb(107, 231, 72);"># 1表示开启镜像，0表示关闭，也可以用true和false来表示</span></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">     crop_size: 227 <span style="color: rgb(107, 231, 72);"># 剪裁一个227*227的图块，在训练阶段随机剪裁，在测试阶段从中间裁剪</span></span></div><div style="margin-left:80px;"><span style="color: rgb(168, 168, 168);">}</span></div><div><br/></div><div><b>data_param</b>: 根据数据的来源不同，来进行不同的配置。</div><div><br/></div><div style="margin-left:40px;"><b>1.数据来自于数据库(如LevelDB和LMDB)</b></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">层类型(Layer type): Data</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">必须设置的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     source: 包含数据库的目录名称，如examples/mnist/mnist_train_lmdb</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     batch_size: 每次处理的数据个数，如64</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">可选的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     rand_skip: 在开始的时候，路过某个数据的输入。通常对异步的SGD很有用</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     backend: 选择是采用LevelDB还是LMDB，默认是LevelDB</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">示例：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     <span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          name: &quot;mnist&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          type: &quot;Data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;label&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          include {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               phase: TRAIN</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          transform_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               scale: 0.00390625</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          data_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               source: &quot;examples/mnist/mnist_train_lmdb&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               batch_size: 64</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               backend: LMDB</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;"><b>2.数据来自于内存</b></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">层类型：MemoryData</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">必须设置的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     batch_size: 每一次处理的数据个数，比如2</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     channels: 通道数</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     height: 高度</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     width: 宽度</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">示例：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     <span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;label&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          name: &quot;memory_data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          type: &quot;MemoryData&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          memory_data_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               batch_size: 2</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               height: 100</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               width: 100</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               channels: 1</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          transform_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               scale: 0.0078125</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mean_file: &quot;mean.proto&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mirror: false</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;"><b>3.数据来自于HDF5</b></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">层类型：HDF5Data</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">必须设置的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     source: 读取的文件名称</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     batch_size: 每一次处理的数据个数</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">示例：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     <span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          name: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          type: &quot;HDF5Data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;label&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          hdf5_data_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               source: &quot;examples/hdf5_classification/data/train.txt&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               batch_size: 10</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;"><b>4.数据来自于图片</b></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">层类型：ImageData</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">必须设置的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     source: 一个文本文件的名字，每一行给定一个图片文件的名称和标签(label)</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     batch_size: 每一次处理的数据个数，即图片数</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">可选参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     rand_skip: 在开始的时候，路过某个数据的输入。通常对异步的SGD很有用</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     shuffle: 随机打乱顺序，默认值为false</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     new_height, new_width: 如果设置，则将图片进行resize</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">示例：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     <span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          name: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          type: &quot;ImageData&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;label&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          transform_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mirror: false</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               crop_size: 227</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mean_file: &quot;data/ilsvrc12/imagenet_mean.binaryproto&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          image_data_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               source: &quot;examples/_temp/file_list.txt&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               batch_size: 50</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               new_height: 256</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               new_weight: 256</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;"><b>5.数据来源于Windows</b></div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">层类型： WindowData</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">必须设置的参数：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     source: 一个文本文件的名字</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     batch_size: 每一次处理的数据个数</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">示例：</div><div style="margin-left:40px;"><br/></div><div style="margin-left:40px;">     <span style="color: rgb(168, 168, 168);">layer {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          name: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          type: &quot;WindowData&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;data&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          top: &quot;label&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          include {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               phase: TRAIN</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          transform_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mirror: true</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               crop_size: 227</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               mean_file: &quot;data/ilsvrc12/imagenet_mean.binaryproto&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          window_data_param {</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               source: &quot;examples/finetune_pascal_detection/window_file_2007_trainval.txt&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               batch_size: 128</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               fg_threshold: 0.5</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               bg_threshold: 0.5</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               fg_fraction: 0.25</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               context_pad: 16</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">               crop_mode: &quot;warp&quot;</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">          }</span></div><div style="margin-left:40px;"><span style="color: rgb(168, 168, 168);">     }</span></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 