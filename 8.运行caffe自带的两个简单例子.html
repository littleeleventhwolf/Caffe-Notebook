<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="418"/>

<div>
<span><div>为了程序的简洁，在caffe中是不带练习数据的，因此需要自己下载。但在caffe根目录下的data文件夹里，作者已经为我们编写好了下载数据的脚本文件，我们只需要联网，运行这些脚本就行了。</div><div><br/></div><div><span style="color: rgb(227, 0, 0);">注意：在caffe中运行所有程序，都必须在根目录下进行，否则会出错。</span></div><div><br/></div><div><b>1.mnist实例</b></div><div><br/></div><div>mnist是一个手写数字库，由DL大牛Yan LeCun进行维护。mnist最初用于支票上的手写数字识别，现在成了DL的入门练习库。针对mnist识别的专门模型是Lenet，算是最早的CNN模型。</div><div><br/></div><div>mnist数据训练样本为60000张，测试样本为10000张，每个样本为28*28大小的黑白图片，手写数字识别0~9，因此分为10类。</div><div><br/></div><div>首先下载mnist数据，假设当前路径为caffe根目录</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo sh data/mnist/get_mnist.sh</div></div><div><br/></div><div>运行成功后，在data/mnist/目录下有四个文件：</div><div><br/></div><ul><li>train-images-idx3-ubyte：训练集样本</li><li>train-labels-idx1-ubyte：训练集对应标注</li><li>t10k-images-idx3-ubyte：测试集图片</li><li>t10k-labels-idx1-ubyte：测试集对应标注</li></ul><div><br/></div><div>这些数据不能在caffe中直接使用，需要转换成LMDB数据：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo sh examples/mnist/create_mnist.sh</div></div><div><br/></div><div>如果想运行leveldb数据，请运行examples/siamese/文件夹下面的程序。examples/mnist/文件夹是运行lmdb数据。</div><div><br/></div><div>转换成功后，会在examples/mnist/目录下，生成两个文件夹，分别是mnist_train_lmdb和mnist_test_lmdb，里面存放的data.mdb和lock.mdb，就是我们需要的运行数据。</div><div><br/></div><div>接下来是修改配置文件，如果你有GPU且已经完全安装好，这一步可以省略；如果没有，则需要修改solver配置文件。</div><div><br/></div><div>需要的配置文件有两个，一个是lenet_solver.prototxt，另一个是train_lenet.prototxt。</div><div><br/></div><div>首先打开lenet_solver.prototxt：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo vim exmaples/mnist/lenet_solver.prototxt</div></div><div><br/></div><div>根据需要，在max_iter处设置最大迭代数，以及决定最后一行solver_mode，是否要改成CPU。保存退出后，就可以运行这个例子了:</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo time sh examples/mnist/train_lenet.sh</div></div><div><br/></div><div>CPU运行时间大约13分钟，GPU运行时间大约4分钟，GPU+cudnn运行时间大约40秒，精度都为99%左右。</div><div><br/></div><div><b>2.cifar10实例</b></div><div><br/></div><div>cifar10数据训练样本50000张，测试样本10000张，每张为32*32的彩色三通道图片，共分为10类。</div><div><br/></div><div>下载数据：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo sh data/cifar10/get_cifar10.sh</div></div><div><br/></div><div>运行成功后，会在data/cifar10/文件夹下生成一堆bin文件。</div><div><br/></div><div>转换数据格式为lmdb：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo sh examples/cifar10/create_cifar10.sh</div></div><div><br/></div><div>转换成功后，会在examples/cifar10/文件夹下生成两个文件夹，cifar10_train_lmdb和cifar10_test_lmdb，里面的文件就是我们需要的文件。</div><div><br/></div><div>为了节省时间，我们进行快速训练(train quick)，训练分为两个阶段，第一个阶段(迭代4000次)调用配置文件cifar10_quick_solver.prototxt，学习率(base_lr)为0.001。</div><div><br/></div><div>第二个阶段(迭代1000次)调用配置文件cifar10_quick_solver_lr1.prototxt，学习率(base_lr)为0.0001。</div><div><br/></div><div>前后两个配置文件就是学习率(base_lr)和最大迭代次数(max_iter)不一样，其他都是一样的。如果你对配置文件比较熟悉以后，实际上是可以将两个配置文件合二为一的，设置lr_policy为multistep就可以了。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>base_lr: 0.001</div><div>momentum: 0.9</div><div>weight_decay: 0.004</div><div>lr_policy: &quot;multistep&quot;</div><div>gamma: 0.1</div><div>stepvalue: 4000</div><div>stepvalue: 5000</div></div><div><br/></div><div>运行例子：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div># sudo time sh examples/cifar10/train_quick.sh</div></div><div><br/></div><div>GPU+cidnn大约45秒左右，精度75%左右。</div></span>
</div></body></html> 